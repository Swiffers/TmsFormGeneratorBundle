{% block form_fields_widget %}
    {% spaceless %}
        {{ block('collection_widget') }}
    {% endspaceless %}

    <script type="text/javascript">
        var collectionHolder = $('.tms_form_generator__form_fields');
        var $addFieldLink = $('<a href="#" class="btn btn-default add_field_link">Add field</a>');
        var $newLink = $('<div></div>').append($addFieldLink);

        jQuery(document).ready(function() {
            collectionHolder.append($newLink);

            $addFieldLink.on('click', function(e) {
                e.preventDefault();
                addFieldForm(collectionHolder, $newLink);
            });

            collectionHolder.find('.tms_form_generator__form_field').each(function() {
                addFieldFormDeleteLink($(this));
            });
        });

        function addFieldForm(collectionHolder, $newLink) {
            var prototype = collectionHolder.attr('data-prototype');
            var newForm = prototype.replace(/__name__/g, collectionHolder.children().length);
            var $newFormDiv = $('<div></div>').append(newForm);
            $newLink.before($newFormDiv);
            addFieldFormDeleteLink($newFormDiv);
        }

        function addFieldFormDeleteLink($fieldFormDiv) {
            var $removeFormA = $('<a href="#" class="btn btn-default">Delete field</a>');
            $fieldFormDiv.append($removeFormA);

            $removeFormA.on('click', function(e) {
                e.preventDefault();
                $fieldFormDiv.remove();
            });
        }
    </script>
{% endblock %}
